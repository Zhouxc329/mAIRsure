<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>logo</title>
        <link rel="stylesheet" href="css/style.css">
        
        <script>
            async function readMetaData(){
                let url = 'doc/WYO_MetaData.json';
                try{
                    let res = await fetch(url);
                    
                    return await res.json();
                } catch (error) {
                    console.log(error);
                }
            }

            function initMap() {
                let data = readMetaData();
                data.then(temp => {const Latitude = temp.map(wellpad => wellpad.Lat)});
                data.then(temp => {const Longitude = temp.map(wellpad => wellpad.Lon)});
                data.then(temp => {const Q_med = temp.map(wellpad => wellpad.Q_med)});
                data.then(temp => {const Q_high = temp.map(wellpad => wellpad.Q_high)});
                data.then(temp => {const Q_low = temp.map(wellpad => wellpad.Q_low)});
                data.then(temp => {const WellDetect = temp.map(wellpad => wellpad.Detections)});
                data.then(temp => {const Anomaly = temp.map(wellpad => wellpad.Abnormal)});
                data.then(temp => {const WellName = temp.map(wellpad => wellpad.Wellhead(s))});

                var count, marker;

                // Init map
                var mapOptions = {
                    zoom: 13,
                    center: new google.maps.LatLng(Latitude[0], Longitude[0]),
                    scrollwheel: true,
                };

                var map = new google.maps.Map(document.getElementById("map"), mapOptions);

                // Create info window
                var infowindow = new google.maps.InfoWindow({
                    maxWidth: 350,
                    pixelOffset: new google.maps.Size(-10,-25)
                });

                var infoFn = function (count) {
                    return function (e) {
                        var content = '<div>' +
                            '<span> Name: ' + WellName[count] + '</span>' +
                            '<span>, Detections: ' + WellDetect[count] + '</span>' +
                            '<span>, Anomaly: ' + Anomaly[count] + '</span>' +
                            '<span>, Emission: ' + Q_med[count] + '</span>' +
                            '<span>, Confidence range: ' + Q_low[count] + 'to' + Q_high[count] + '</span>' +
                            '</div>';
                        infowindow.setContent(content);
                        infowindow.open(map);
                        infowindow.setPosition(new google.maps.LatLng(Latitude[count], Longitude[count]));
                    }
                };

                // Add markers
                for (count = 0; count < Latitude.length; count++) {
                    marker = new google.maps.Marker({
                        position: new google.maps.LatLng(Latitude[count], Longitude[count]),
                        map: map,
                        title: WellName[count]
                    });
                    marker.setMap(map);

                    let fn = infoFn(count);
                    google.maps.event.addListener(marker, 'click', fn);
                }
            }
        </script>
    </head>

    <body>
        <div id="map"></div>
        <!-- Async script executes immediately and must be after any DOM elements used in callback. -->
        <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB41DRUbKWJHPxaFjMAwdrzWzbVKartNGg&callback=initMap&libraries=&v=weekly&channel=2"
        async
        ></script>
        
        <h2>Clickable Dropdown</h2>
        <p>Click on the button to open the dropdown menu.</p>
        <div class="dropdown">
        <button onclick="myFunction()" class="dropbtn">Locate a site</button>
            <div id="myDropdown" class="dropdown-content">
            <a href="#home">Home</a>
            <a href="#about">About</a>
            <a href="#contact">Contact</a>
            </div>
        </div>
    </body>

</html>
